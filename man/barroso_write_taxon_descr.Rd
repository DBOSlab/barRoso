% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/barroso_write_taxon_descr.R
\name{barroso_write_taxon_descr}
\alias{barroso_write_taxon_descr}
\title{Build species morphological descriptions from an Excel spreadsheet and export to Word (.docx).}
\usage{
barroso_write_taxon_descr(
  xlsx_path,
  species_cols,
  character_cols,
  sheet = 1,
  species_filter = NULL,
  font_family = "Times New Roman",
  font_size = 12,
  species_bold = TRUE,
  species_italic = TRUE,
  group_bold = TRUE,
  group_italic = FALSE,
  description_bold = FALSE,
  description_italic = FALSE,
  verbose = TRUE,
  dir = NULL,
  filename = NULL
)
}
\arguments{
\item{xlsx_path}{Character string. Path to the .xlsx file containing
morphological data.}

\item{species_cols}{Character vector or integer indices. Column names or
indices used to build the species header (e.g., c("Genus", "Species",
"Author") or 1:3).}

\item{character_cols}{Character vector or integer indices. Column names or
indices of morphological character columns (e.g., c("Habit", "Leaf.length",
"Leaf.width") or 4:20).}

\item{sheet}{Character string or integer. Sheet name or index passed to
\code{readxl::read_excel()}. Default is 1.}

\item{species_filter}{Optional character vector of species names to filter.
Only species matching these names will have descriptions generated.
The names should match the species name as it appears when concatenating
the \code{species_cols} columns (without authorship).}

\item{font_family}{Character string. Font family for the Word document.
Default is "Times New Roman". Common options include "Arial", "Calibri",
"Cambria".}

\item{font_size}{Numeric. Font size in points. Default is 12.}

\item{species_bold}{Logical. Whether to make species names bold.
Default is TRUE.}

\item{species_italic}{Logical. Whether to make species names italic.
Default is TRUE (following botanical conventions).}

\item{group_bold}{Logical. Whether to make group names (e.g., "Habit",
"Leaf") bold. Default is TRUE.}

\item{group_italic}{Logical. Whether to make group names italic.
Default is FALSE.}

\item{description_bold}{Logical. Whether to make description text bold.
Default is FALSE.}

\item{description_italic}{Logical. Whether to make description text italic.
Default is FALSE.}

\item{verbose}{Logical. If \code{TRUE} (default), progress messages are
printed to the console. Set to \code{FALSE} for silent operation.}

\item{dir}{Character string. Directory path where output will be saved.
A date-stamped subfolder will be created inside this directory. If
\code{NULL}, uses the Excel filename as directory name.}

\item{filename}{Character string. Basename for output files (without
extension). If \code{NULL}, uses the Excel filename with "_descriptions"
suffix.}
}
\value{
Invisibly returns a data.frame with two columns:
\itemize{
\item{\code{species_name}: Full species name with authorship}
\item{\code{description_plain}: Plain text description}
}
The main output is a Word document (.docx) saved to the specified directory.
}
\description{
This function reads morphological data from an Excel spreadsheet,
generates standardized species descriptions in plain text and Word document formats,
and exports them to a Word (.docx) file. It handles complex morphological data
structures including measurements, subterms, and grouping of related characters.
The function automatically detects measurement ranges and formats them with
en dashes (e.g., "4.3–14.5 cm").
}
\details{
The function expects an Excel file with specific column naming conventions.
Species names should be in separate columns (e.g., "Genus", "Species", "Author").
Morphological characters should be grouped with consistent naming patterns:
\itemize{
\item Simple characters: "Habit", "LEAF shape", "LEAF margin"
\item Measurements: "LEAF length (cm)", "LEAF width (mm)"
\item Hierarchical structures: "FLOWER SEPALS length (mm)", "FLOWER SEPALS width (mm)"
}

The function automatically:
\itemize{
\item{Detects and groups related morphological characters}
\item{Handles measurement ranges (e.g., "4.3-14.5" becomes "4.3–14.5")}
\item{Merges duplicate species entries}
\item{Formats descriptions with customizable text formatting}
\item{Exports to Word with proper scientific typography}
}

Text formatting can be controlled via the \code{species_bold}, \code{group_bold},
and related parameters. Species names are italicized by default following
botanical conventions.
}
\section{Column naming conventions and text construction}{

The function comprehensively parses column names to construct coherent descriptions.
Capitalized terms in column names serve as organizational elements that are
pulled out and used to structure the description text. Follow these conventions:

\describe{
\item{Species columns}{One or more columns containing taxonomic information.
Can be flexible combinations:
\itemize{
\item{Single column: "Species_name" (e.g., "Ouratea concinna")}
\item{Two columns: "Genus" and "Species" (e.g., "Ouratea" and "concinna")}
\item{Three columns: "Genus", "Species", and "Author" (e.g., "Ouratea",
"concinna", and "(Mart.) Engl.")}
\item{Any other combination needed for your data structure}
}
These are concatenated to form the species header.}
\item{Main character groups}{Use ALL CAPS: "HABIT", "LEAF",
"Flower". These become section headers in the description.}
\item{Hierarchical structures}{Use ALL CAPS for sub-levels: "LEAF shape",
"LEAF margin", "FLOWER PETALS color". The capitalized terms ("LEAF",
"PETALS") are extracted once and the descriptive text from the cell is
appended. For example, a column named "LEAF shape" with cell value
"elliptic to ovate" produces: "leaf elliptic to ovate".}
\item{Measurements}{Include units in parentheses: "LEAF length (cm)",
"PETAL width (mm)". Measurements with multiple values (e.g., "4.3-14.5")
are automatically formatted with en dashes: "4.3–14.5 cm".}
\item{Related measurements}{Columns like "LEAF length (cm)" and
"LEAF width (cm)" are automatically combined: "4.3–14.5 × 2.1–3.8 cm".}
\item{Higher hierarchies}{Complex structures like "FLOWER SEPALS BASE shape"
are parsed as: "flower sepals base" + cell value. This allows grouping
related characters under common headings.}
}
}

\section{Examples of species column flexibility}{

\preformatted{
# Example 1: Single species name column
species_cols = "Species"  # Column contains "Ouratea concinna (Mart.) Engl."

# Example 2: Separate genus and species
species_cols = c("Genus", "Species")  # "Ouratea" + "concinna"

# Example 3: With separate authorship
species_cols = c("Genus", "Species", "Author")  # "Ouratea" + "concinna" + "(Mart.) Engl."

# Example 4: With infraspecific rank
species_cols = c("Genus", "Species", "Infrasp_rank", "Infrasp", "Author")
# Produces: "Ouratea concinna subsp. coarctata (Mart.) Engl."
}
}

\section{How descriptions are constructed}{

For each species, the function:
\enumerate{
\item \strong{Parses column names} to extract hierarchical structure
\item \strong{Groups related characters} based on capitalized terms
\item \strong{Extracts capitalized terms once} to avoid repetition
\item \strong{Appends cell values} to create natural language descriptions
\item \strong{Formats measurements} with proper units and en dashes
\item \strong{Organizes text} with appropriate punctuation
}

Example transformation:
\preformatted{
Column name: "LEAF shape" with cell value: "elliptic to ovate"
Result in description: "leaf elliptic to ovate"

Column names: "LEAF length (cm)" (value: "4.3-14.5") and
              "LEAF width (cm)" (value: "2.1-3.8")
Result in description: "leaf 4.3–14.5 × 2.1–3.8 cm"

Column names: "FLOWER PETALS color" (value: "white") and
              "FLOWER PETALS number" (value: "5")
Result in description: "flower petals white, 5"
}
}

\section{Output structure}{

The generated Word document contains:
\itemize{
\item{Species name with authorship (italicized by default)}
\item{Morphological description organized by character groups}
\item{Measurements formatted with proper units and en dashes for ranges}
\item{Hierarchical characters grouped logically}
}
}

\examples{
\dontrun{
# Basic usage - generate descriptions for all species
barroso_write_taxon_descr(
  xlsx_path = "morphological_data.xlsx",
  species_cols = c("Genus", "Species", "Author"),
  character_cols = 4:20
)

# Generate descriptions only for specific species
barroso_write_taxon_descr(
  xlsx_path = "morphological_data.xlsx",
  species_cols = c("Genus", "Species"),
  character_cols = 3:15,
  species_filter = c("Ouratea concinna", "Ouratea coarctata")
)

# Customize formatting
barroso_write_taxon_descr(
  xlsx_path = "morphological_data.xlsx",
  species_cols = 1:3,
  character_cols = 4:25,
  font_family = "Arial",
  font_size = 11,
  species_bold = TRUE,
  species_italic = TRUE,
  group_bold = FALSE,
  group_italic = TRUE,
  description_bold = FALSE,
  description_italic = FALSE,
  filename = "MySpeciesDescriptions",
  dir = "Output"
)

# Using column indices instead of names
barroso_write_taxon_descr(
  xlsx_path = "data.xlsx",
  species_cols = 1:2,          # First two columns: Genus and Species
  character_cols = 3:18        # Columns 3-18: morphological characters
)
}

}
\author{
Domingos Cardoso
}
